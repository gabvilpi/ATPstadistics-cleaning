---
title: "PEC3 - Modelaci?n predictiva"
author: "Alejandro Manuel Olivares Luque"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output:
  html_document:
    toc: yes
    toc_depth: 4
  pdf_document:
    toc: yes
    toc_depth: 4
---

#PEC3 - Modelación predictiva

## Descripción del dataset. ?Por qu? es importante y qu? pregunta/problema pretende responder?
##Integración y selecci?n de los datos de inter?s a analizar.
Se realiza la carga de los datos. 
```{r chunck1}
library(readxl)
ATPstatistics <- read_excel("../Data/ATPstatistics.xlsx")
head(ATPstatistics)
```
Una vez que hemos realizado la carga correcta de los datos. A continuación, veremos el tipo de datos seleccionado por R para cada campo.
```{r chunck2}
str(ATPstatistics)
```
Como podemos observar, los tipos de datos que R ha seleccionado a cada variable no es el mejor, por lo quie procedemos a transformarlos a un tipo de datos más adecuado. 

```{r chunck3}
ATPstatistics$id_partido<-as.integer(ATPstatistics$id_partido)
ATPstatistics$`Player 1`<-as.factor(ATPstatistics$`Player 1`)
ATPstatistics$`Player 2`<-as.factor(ATPstatistics$`Player 2`)
ATPstatistics$`Serve Rating 1` <- as.integer(ATPstatistics$`Serve Rating 1`)
ATPstatistics$`Serve Rating 2` <- as.integer(ATPstatistics$`Serve Rating 2`)
ATPstatistics$`Aces 1`<- as.integer(ATPstatistics$`Aces 1`)
ATPstatistics$`Aces 2`<- as.integer(ATPstatistics$`Aces 2`)
ATPstatistics$`Double Faults 1` <- as.integer(ATPstatistics$`Double Faults 1`)
ATPstatistics$`Double Faults 2` <- as.integer(ATPstatistics$`Double Faults 2`)
ATPstatistics$`Served games played 1` <- as.integer(ATPstatistics$`Served games played 1`)
ATPstatistics$`Served games played 2` <- as.integer(ATPstatistics$`Served games played 2`)
ATPstatistics$`Return rating 1` <- as.integer(ATPstatistics$`Return rating 1`)
ATPstatistics$`Return rating 2` <- as.integer(ATPstatistics$`Return rating 2`)
ATPstatistics$`Return games played 1` <- as.integer(ATPstatistics$`Return games played 1`)
ATPstatistics$`Return games played 2` <- as.integer(ATPstatistics$`Return games played 2`)
ATPstatistics$Winner <- as.factor(ATPstatistics$Winner)
ATPstatistics$Tournament <- as.factor(ATPstatistics$Tournament)
ATPstatistics$`Started date` <- as.Date(as.character(ATPstatistics$`Started date`), "%d/%m/%Y")
ATPstatistics$`Ended date` <- as.Date(as.character(ATPstatistics$`Ended date`),  "%d/%m/%Y")
ATPstatistics$Surface <- as.factor(ATPstatistics$Surface)
ATPstatistics$`% 1st Serve 1` <- as.double(ATPstatistics$`% 1st Serve 1`)/100
ATPstatistics$`% 1st Serve 2` <- as.double(ATPstatistics$`% 1st Serve 2`)/100
ATPstatistics$`% 1st serve won 1` <-as.double(ATPstatistics$`% 1st serve won 1`)/100
ATPstatistics$`% 1st serve won 2` <-as.double(ATPstatistics$`% 1st serve won 2`)/100
ATPstatistics$`% 2nd serve won 1` <-as.double(ATPstatistics$`% 2nd serve won 1`)/100
ATPstatistics$`% 2nd serve won 2` <-as.double(ATPstatistics$`% 2nd serve won 2`)/100
ATPstatistics$`% Break point saved 1` <- as.double(ATPstatistics$`% Break point saved 1`)/100
ATPstatistics$`% Break point saved 2` <- as.double(ATPstatistics$`% Break point saved 2`)/100
ATPstatistics$`% Served point won 1` <- as.double(ATPstatistics$`% Served point won 1`)/100
ATPstatistics$`% Served point won 2` <- as.double(ATPstatistics$`% Served point won 2`)/100
ATPstatistics$`% Return point won 1` <- as.double(ATPstatistics$`% Return point won 1`)/100
ATPstatistics$`% Return point won 2` <- as.double(ATPstatistics$`% Return point won 2`)/100
ATPstatistics$`% Total point won 1` <- as.double(ATPstatistics$`% Total point won 1`)/100
ATPstatistics$`% Total point won 2` <- as.double(ATPstatistics$`% Total point won 2`)/100
ATPstatistics$`% 1st serve return won 1` <- as.double(ATPstatistics$`% 1st serve return won 1`)/100
ATPstatistics$`% 1st serve return won 2` <- as.double(ATPstatistics$`% 1st serve return won 2` )
ATPstatistics$`% 2nd serve return won 1`<- as.double(ATPstatistics$`% 2nd serve return won 1`)
ATPstatistics$`% 2nd serve return won 2`<- as.double(ATPstatistics$`% 2nd serve return won 2`)
ATPstatistics$`% Break point converted 1`<- as.double(ATPstatistics$`% Break point converted 1`)
ATPstatistics$`% Break point converted 2`<- as.double(ATPstatistics$`% Break point converted 2`)
str(ATPstatistics)
```
Quitaremos el número total de juegos al servicio y al resto, ya que a priori, no nos aporta información relativa al juego de cada jugador. 
```{r chunck4}
ATPstatistics<-ATPstatistics[-c(18:19)]
ATPstatistics<-ATPstatistics[-c(26:27)]
```
Los datos no están del todo preparados, ya que tenemos las estadisticas reales de los partidos. Necesitamos obtener las estimaciones de los partidos, para ello, realizaremos la media y varianza de las estadisticas de los últimos partidos de cada jugador.
```{r chunck7}
require(data.table)
partidos = 5
for(i in 1:nrow(ATPstatistics)){
  jugador1<-as.character(ATPstatistics$`Player 1`[i])
  jugador2<-as.character(ATPstatistics$`Player 2`[i])
  variablesj1 <- c(1,seq(4,31,by = 2))
  variablesj2 <- c(1,seq(5,32,by = 2))
  otras_variables <- seq(33,ncol(ATPstatistics),by = 1)
  estadisticas_jugador1_1 <-ATPstatistics[which(ATPstatistics$`Player 1`==jugador1),variablesj1]
  estadisticas_jugador1_2 <-ATPstatistics[which(ATPstatistics$`Player 2`==jugador1),variablesj2]
  estadisticas_jugador2_1 <-ATPstatistics[which(ATPstatistics$`Player 1`==jugador2),variablesj1]
  estadisticas_jugador2_2 <-ATPstatistics[which(ATPstatistics$`Player 2`==jugador2),variablesj2]
  estadisticas_jugador1 <- rbind(as.matrix(estadisticas_jugador1_1),as.matrix(estadisticas_jugador1_2))
  estadisticas_jugador2 <- rbind(as.matrix(estadisticas_jugador2_1),as.matrix(estadisticas_jugador2_2))
  estadisticas_jugador1<-data.table(estadisticas_jugador1,key="id_partido")
  estadisticas_jugador2<-data.table(estadisticas_jugador2,key="id_partido")
  estadisticas_jugador1 <- estadisticas_jugador1[1:partidos,]
  estadisticas_jugador2 <- estadisticas_jugador2[1:partidos,]
}
```

##Limpieza de los datos.

###?Los datos contienen ceros o elementos vac?os? ?C?mo gestionar?as cada uno de estos casos?
```{r chunck5}
summary(ATPstatistics)
```
Existen observaciones con datos a cero, lo que denota que dichas observaciones no se han recogido datos para el partido. Los eliminamos a continuación.
```{r chunck6}
ATPstatistics<- ATPstatistics[which(ATPstatistics$`Serve Rating 1`!=0 & ATPstatistics$`Serve Rating 2`!=0 & ATPstatistics$`Return rating 1` !=0 & ATPstatistics$`Return rating 2` !=0),]
```
### Identificaci?n y tratamiento de valores extremos.
## An?lisis de los datos.
###Selecci?n de los grupos de datos que se quieren analizar/comparar(planificaci?n de los an?lisis a aplicar).
### Comprobaci?n de la normalidad y homogeneidad de la varianza.
### Aplicaci?n de pruebas estad?sticas para comparar los grupos de datos. En funci?n de los datos y el objetivo del estudio, aplicar pruebas de contrastede hip?tesis, correlaciones, regresiones, etc.
## Representaci?n de los resultados a partir de tablas y gr?ficas.
##Resoluci?n del problema. A partir de los resultados obtenidos, ?cu?les son las conclusiones? ?Los resultados permiten responder al problema?
## C?digo: Hay que adjuntar el c?digo, preferiblemente en R, con el que se ha realizado la limpieza, an?lisis y representaci?n de los datos. Si lo prefer?s, tambi?n pod?is trabajar en Python. 
